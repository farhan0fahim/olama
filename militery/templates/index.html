<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OSINT COMMAND CENTER | V13</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        body { background-color: #05070a; color: #00ff41; font-family: 'JetBrains Mono', monospace; overflow: hidden; height: 100vh; }
        .mili-card { background: rgba(10, 20, 30, 0.95); border: 1px solid #1a2a3a; }
        .btn-tactical { border: 1px solid #00ff41; padding: 8px 15px; background: rgba(0,255,65,0.05); color: #00ff41; font-size: 10px; cursor: pointer; transition: 0.2s; }
        .btn-tactical:hover { background: #00ff41; color: #000; font-weight: bold; box-shadow: 0 0 10px #00ff41; }
        .input-dark { background: #000; border: 1px solid #1a2a3a; color: #00ff41; padding: 10px; font-size: 11px; outline: none; width: 100%; }
        .status-terminal { background: #000; border: 1px solid #1a2a3a; font-size: 10px; color: #008f11; height: 180px; overflow-y: auto; padding: 10px; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 100; align-items: center; justify-content: center; }
        .summary-box { background: rgba(0, 255, 65, 0.03); border-left: 3px solid #00ff41; padding: 20px; font-size: 12px; line-height: 1.8; color: #cbd5e0; text-align: justify; }
        .accent-green { accent-color: #00ff41; width: 15px; height: 15px; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #00ff41; }
    </style>
</head>
<body class="p-4 flex flex-col h-screen">

    <!-- Header -->
    <header class="flex justify-between items-center border-b border-green-900 pb-2 mb-4">
        <div>
            <h1 class="text-3xl font-bold tracking-tighter text-green-500 italic uppercase">COMMAND_CENTER_V13</h1>
            <p class="text-[9px] uppercase opacity-40 tracking-[0.4em]">Global Intercept & AI Dossier Synthesis</p>
        </div>
        <div class="flex items-center gap-6">
            <p id="clock" class="text-2xl font-bold text-green-400">00:00:00</p>
            <button onclick="toggleModal(true)" class="btn-tactical"><i class="fas fa-plus mr-1"></i>DEPLOY PROBE</button>
        </div>
    </header>

    <div class="grid grid-cols-12 gap-4 flex-grow overflow-hidden">
        <!-- Sidebar -->
        <div class="col-span-12 lg:col-span-3 space-y-4 overflow-y-auto pr-2">
            
            <!-- Timers -->
            <div class="mili-card p-4">
                <h2 class="text-[10px] text-green-600 font-bold mb-3 uppercase">System Timers</h2>
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <label class="text-[9px]">SYNC CYCLE (M):</label>
                        <div class="flex gap-1">
                            <input type="number" id="syncMin" value="5" class="input-dark w-12 text-center">
                            <button onclick="updateSyncTimer()" class="btn-tactical text-[8px]">SET</button>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <label class="text-[9px]">ARCHIVE (M):</label>
                        <div class="flex gap-1">
                            <input type="number" id="archiveMin" value="15" class="input-dark w-12 text-center">
                            <button onclick="updateArchiveTimer()" class="btn-tactical text-[8px]">SET</button>
                        </div>
                    </div>
                    <button onclick="forceSync()" class="w-full btn-tactical font-bold bg-green-900/20 mt-2">
                        <i class="fas fa-sync-alt mr-2"></i>FORCE GLOBAL RE-SCAN
                    </button>
                </div>
            </div>

            <!-- Parameters -->
            <div class="mili-card p-4">
                <form id="intelForm" action="/generate-intel" method="POST" class="space-y-4">
                    <p class="text-[9px] text-green-900 font-bold mb-1 uppercase border-b border-green-950 pb-1">Target Grid</p>
                    <div class="space-y-1" id="grid-list">
                        {% for name, cfg in outlets.items() %}
                        <div class="flex justify-between items-center text-[10px] bg-green-900/10 p-1 border border-green-900/20">
                            <label><input type="checkbox" name="sources" value="{{name}}" checked class="accent-green mr-2">{{name}}</label>
                            <i onclick="deletePaper('{{name}}')" class="fas fa-times text-red-900 cursor-pointer hover:text-red-500"></i>
                        </div>
                        {% endfor %}
                    </div>

                    <p class="text-[9px] text-green-900 font-bold mt-4 mb-1 uppercase border-b border-green-950 pb-1">Sector Matrix</p>
                    <div class="space-y-1">
                        <label class="flex items-center text-[10px] p-1"><input type="checkbox" name="sectors" value="Politics" checked class="accent-green mr-2">POLITICS</label>
                        <label class="flex items-center text-[10px] p-1"><input type="checkbox" name="sectors" value="National" checked class="accent-green mr-2">NATIONAL / BD</label>
                        <label class="flex items-center text-[10px] p-1"><input type="checkbox" name="sectors" value="Economy" checked class="accent-green mr-2">ECONOMY / BIZ</label>
                    </div>
                    
                    <button type="submit" class="w-full btn-tactical font-bold mt-2 uppercase tracking-widest">Compine Dossier</button>
                </form>
            </div>

            <!-- Terminal -->
            <div class="mili-card p-4">
                <h2 class="text-xs font-bold mb-2 text-green-600 uppercase italic">Sequential Process Terminal</h2>
                <div id="terminal" class="status-terminal">
                    <p>> awaiting system start...</p>
                </div>
            </div>
        </div>

        <!-- Main Feed -->
        <div class="col-span-12 lg:col-span-9 flex flex-col h-full overflow-hidden">
            <div id="news-feed" class="flex-grow overflow-y-auto space-y-6 pr-3 flex flex-col items-center justify-center">
                <!-- SATELLITE HUD -->
                <div id="satellite-loader" class="text-center opacity-20 transition-all duration-1000">
                    <i class="fas fa-satellite-dish text-[160px] mb-8 animate-pulse"></i>
                    <h2 class="text-3xl font-bold tracking-[1em] uppercase">Awaiting Synchronized Intercept...</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="addModal" class="modal">
        <div class="mili-card p-8 w-full max-w-2xl border-2 border-green-500">
            <h2 class="text-green-500 font-bold uppercase mb-6 italic border-b border-green-900 pb-2">New Target Deployment</h2>
            <form id="addPaperForm" class="space-y-4">
                <input type="text" name="name" placeholder="ORGANIZATION NAME (e.g. BBC NEWS)" class="input-dark" required>
                <div class="flex gap-4">
                    <label class="text-xs cursor-pointer"><input type="radio" name="type" value="national" checked onclick="toggleType('nat')"> National (BD Based)</label>
                    <label class="text-xs cursor-pointer"><input type="radio" name="type" value="international" onclick="toggleType('int')"> International (Global)</label>
                </div>
                <div id="nat-fields" class="space-y-2">
                    <input type="text" name="pol" placeholder="Politics Section Full URL" class="input-dark">
                    <input type="text" name="eco" placeholder="Economy Section Full URL" class="input-dark">
                    <input type="text" name="nat" placeholder="National/BD Section Full URL" class="input-dark">
                </div>
                <div id="int-fields" class="hidden">
                    <input type="text" name="intl_url" placeholder="International Source URL (e.g. Al Jazeera Bangladesh Page)" class="input-dark">
                </div>
                <div class="flex gap-4 pt-4">
                    <button type="button" onclick="submitPaper()" class="btn-tactical flex-grow">DEPLOY TARGET</button>
                    <button type="button" onclick="toggleModal(false)" class="btn-tactical flex-grow border-red-900 text-red-500">ABORT MISSION</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function updateClock() { document.getElementById('clock').innerText = new Date().toTimeString().split(' ')[0]; }
        setInterval(updateClock, 1000);
        function toggleModal(s) { document.getElementById('addModal').style.display = s ? 'flex' : 'none'; }
        function toggleType(t) {
            document.getElementById('nat-fields').classList.toggle('hidden', t === 'int');
            document.getElementById('int-fields').classList.toggle('hidden', t === 'nat');
        }

        async function updateSyncTimer() {
            const fd = new FormData(); fd.append('minutes', document.getElementById('syncMin').value);
            await fetch('/update-sync-timer', { method: 'POST', body: fd });
            alert("Sync cycle reconfigured.");
        }

        async function forceSync() {
            await fetch('/force-sync', { method: 'POST' });
            document.getElementById('terminal').innerHTML += "<p>> manual override: starting global sync...</p>";
        }

        async function updateArchiveTimer() {
            const fd = new FormData(); fd.append('minutes', document.getElementById('archiveMin').value);
            await fetch('/update-archive-timer', { method: 'POST', body: fd });
            alert("Archive cycle reconfigured.");
        }

        async function submitPaper() {
            const fd = new FormData(document.getElementById('addPaperForm'));
            await fetch('/add-paper', { method: 'POST', body: fd });
            location.reload();
        }

        async function deletePaper(name) {
            if(confirm("Neutralize Target: " + name + "?")) {
                const fd = new FormData(); fd.append('name', name);
                await fetch('/delete-paper', { method: 'POST', body: fd });
                location.reload();
            }
        }

        async function refreshFeed() {
            const sources = Array.from(document.querySelectorAll('input[name="sources"]:checked')).map(cb => cb.value);
            const sectors = Array.from(document.querySelectorAll('input[name="sectors"]:checked')).map(cb => cb.value);
            if(sources.length === 0) return;
            const q = new URLSearchParams();
            sources.forEach(s => q.append('selected_sources', s));
            sectors.forEach(s => q.append('selected_sectors', s));

            const res = await fetch(`/fetch-news?${q.toString()}`);
            const data = await res.json();
            
            const term = document.getElementById('terminal');
            term.innerHTML = '';
            data.logs.forEach(l => { term.innerHTML += `<p>> ${l}</p>`; });
            term.scrollTop = term.scrollHeight;

            const feed = document.getElementById('news-feed');
            if(data.news.length > 0) {
                feed.classList.remove('items-center', 'justify-center');
                feed.innerHTML = '';
                data.news.forEach(n => {
                    feed.innerHTML += `
                        <div class="mili-card p-8 border-l-4 border-l-green-600 bg-black/40 hover:bg-green-950/10 transition">
                            <div class="flex justify-between text-[10px] text-green-800 mb-2 italic">
                                <span>ORIGIN: ${n.source}</span>
                                <span>PKT: ${n.type.toUpperCase()} // ${n.sector} // ${n.time}</span>
                            </div>
                            <h3 class="text-2xl font-bold text-white mb-4 underline underline-offset-8 decoration-green-900">${n.title}</h3>
                            <div class="summary-box">
                                <i class="fas fa-robot mr-3 text-green-500 text-lg"></i>AI INTELLIGENCE SYNTHESIS:<br><br>${n.summary}
                            </div>
                            <div class="mt-6 flex justify-between items-center">
                                <a href="${n.link}" target="_blank" class="text-[10px] text-blue-800 font-bold uppercase tracking-widest hover:text-blue-400">Access Raw Data Intercept</a>
                                <span class="text-[8px] opacity-20 italic">CLEARANCE: LEVEL 4</span>
                            </div>
                        </div>
                    `;
                });
            }
        }

        setInterval(refreshFeed, 30000);
        setTimeout(refreshFeed, 2500);
    </script>
</body>
</html>